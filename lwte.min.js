!function(e){"use strict;";function t(){this.templates={},arguments.callee.escape_character="#",arguments.callee.IF=0,arguments.callee.EACH=1,arguments.callee.SWITCH=2,arguments.callee.LITERAL=3,arguments.callee.VARIABLE=4,arguments.callee.USE=5,arguments.callee.HTML=6,arguments.callee.DIRECT=7,arguments.callee.DIRECT_HTML=8}function a(e){function a(e){return[0,e]}function r(e,t){return[1,void 0==t?"":t,e[2],e[3],e[1]]}function n(e){return[1,e,[]]}function s(e,t){0!=t.length&&(M.push([e,t,x,O]),V="")}function l(e){switch(e.toLowerCase()){case"if":s(_,e);break;case"elif":s(v,e);break;case"else":s(I,e);break;case"/if":s(R,e);break;case"each":s(T,e);break;case"/each":s(C,e);break;case"switch":s(d,e);break;case"case":s(L,e);break;case"default":s(A,e);break;case"/switch":s(S,e);break;case"use":s(w,e);break;case"html":s(D,e);break;default:s(E,e)}}function c(e,t){e.splice(t,1)}function u(){return Z+ee+te}function i(){var e=u();if(e<se.length-1)c(se,se.length-1);else if(e>se.length-1)for(var t=0,a=e-se.length+1;a>t;t++)se.push(ne)}function h(e){if(i(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)h(e[t]);else-1==se[u()].indexOf(e)&&se[u()].push(e)}function p(e){if(i(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)p(e[t]);else for(var t=0,a=se[u()].length;a>t;t++)if(e==se[u()][t]){c(se[u()],t);break}}function f(){return i(),-1!=se[u()].indexOf(M[G][0])?!0:!1}function o(e){c(P,P.length-1),P[P.length-1]=Q[Q.length-1],c(Q,Q.length-1),void 0!=e&&e>1&&o(e-1)}function g(e){void 0==e&&(e=N.length-1),Q.push(P[P.length-1]),P.push(e)}function b(){N=K;for(var e=0,t=P.length;t>e;e++)N=N[P[e]]}function m(){for(var e=[],t=1,a=Y.length;a>t;t++)e.push(Y[t][1]);return e}for(var k=0,T=1,_=2,v=3,I=4,E=5,d=6,L=7,A=8,H=9,y=10,C=12,R=13,S=14,w=15,D=16,M=[],V="",x=1,O=0,W=!0,B=!1,F=!1,U=!1,j=null,q=0,z=e.length;z>q;q++)"\n"==e[q]&&(x++,O=0),O++,W?B?(B=!1,V+=e[q]==t.escape_character||"{"==e[q]||"}"==e[q]?e[q]:t.escape_character+e[q]):e[q]==t.escape_character?B=!0:"{"==e[q]?(s(k,V),s(H,"{"),W=!1):V+=e[q]:B?(B=!1,V+=e[q]==t.escape_character?e[q]:t.escape_character+e[q]):U?e[q]==t.escape_character?B=!0:e[q]==j?U=!1:V+=e[q]:e[q]==t.escape_character?B=!0:"}"==e[q]?(0!=V.length&&l(V),s(y,"}"),F=!1,W=!0):'"'==e[q]||"'"==e[q]?(U=!0,j=e[q]):" "==e[q]?0!=V.length&&l(V):V+=e[q];if(!W)return n("unclosed curly brackets");0!=V.length&&s(k,V);for(var G=0,J=M.length,K=[],N=K,P=[],Q=[],X=!1,Y=[],Z=0,$=[],ee=0,te=0,ae=[],re=[],ne=[v,I,L,A,C,R,S],se=[ne],le=!1;J>G;){if(f())return r(M[G],"unexpected token");if(b(),X){if(M[G][0]==y){if(X=!1,0==Y.length)N.push([t.DIRECT]);else switch(Y[0][0]){case _:if(1==Y.length)return r(M[G]);Z++,$.push(!1),N.push([t.IF,[[m(),[]]],[]]),g(),g(1),g(0),g(1),p([v,I,R]);break;case v:if(0==Z||1==Y.length||$[Z])return r(M[G]);o(2),b(),N.push([m(),[]]),g(),g(1);break;case I:if(0==Z||$[Z]||1!=Y.length)return r(M[G]);$[Z]=!0,o(3),g(2),h(v);break;case R:if(0==Z||1!=Y.length)return r(M[G]);$[Z]?(c($,Z),o(2)):o(4),Z--;break;case T:if(2!=Y.length)return r(M[G]);ee++,N.push([t.EACH,Y[1][1],[]]),g(),g(2),p(C);break;case C:if(0==ee||1!=Y.length)return r(M[G]);o(2),ee--;break;case d:if(2!=Y.length)return r(M[G]);te++,ae.push(!1),re.push(!1),N.push([t.SWITCH,Y[1][1],[],[]]),g(),g(2),p([L,A,S]),h([T,_,d]),le=!0;break;case L:if(0==te||re[te]||1==Y.length)return r(M[G]);ae[te]&&(o(2),b()),N.push([m(),[]]),g(),g(1),ae[te]=!0,p([T,_,d]),le=!1;break;case A:if(0==te||re[te]||1!=Y.length)return r(M[G]);re[te]=!0,ae[te]?o(3):o(),g(3),h(L),p([T,_,d]),le=!1;break;case S:if(0==te||0==ae[te]||1!=Y.length)return r(M[G]);re[te]?o(2):ae[te]&&o(4),te--,le=!1;break;case E:if(1!=Y.length)return r(M[G]);N.push([t.VARIABLE,Y[0][1]]);break;case w:if(3!=Y.length)return r(M[G]);N.push([t.USE,Y[1][1],Y[2][1]]);break;case D:if(2==Y.length)N.push([t.HTML,Y[1][1]]);else{if(1!=Y.length)return r(M[G]);N.push([t.DIRECT_HTML])}break;default:return r(M[G])}Y=[]}Y.push(M[G])}else switch(M[G][0]){case k:le||N.push([t.LITERAL,M[G][1]]);break;case H:X=!0,Y=[]}G++}if(te>0||Z>0||ee>0){var ce=Z>0?" "+Z+" if":"",ue=ee>0?" "+ee+" each":"",ie=te>0?" "+te+" switch":"";return n("found not closed"+ce+ue+ie)}return a(K)}function r(e,t){var a=this._parseTemplate(t);return 0==a[0]?(this.templates[e]=a[1],!1):a.slice(1)}function n(e){return e===!1||null==e||e instanceof Object&&0===Object.keys(e).length||e instanceof Array&&0==e.length?!1:!0}function s(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function l(e,a){for(var r="",n=0,s=e.length;s>n;n++)switch(e[n][0]){case t.LITERAL:r+=e[n][1];break;case t.VARIABLE:r+=this._escapeHtml(String(a[e[n][1]]));break;case t.HTML:r+=String(a[e[n][1]]);break;case t.DIRECT:r+=this._escapeHtml(String(a));break;case t.DIRECT_HTML:r+=String(a);break;case t.EACH:for(var l=0,c=a[e[n][1]].length;c>l;l++)r+=this._useTemplate(e[n][2],a[e[n][1]][l]);break;case t.IF:for(var u=!0,l=0,c=e[n][1].length;c>l;l++){for(var i=!0,h=0,p=e[n][1][l][0].length;p>h;h++)if(0==this._evaluateVariable(a[e[n][1][l][0][h]])){i=!1;break}if(i){r+=this._useTemplate(e[n][1][l][1],a),u=!1;break}}u&&(r+=this._useTemplate(e[n][2],a));break;case t.SWITCH:for(var f=!0,l=0,c=e[n][2].length;c>l;l++){for(var i=!1,h=0,p=e[n][2][l][0].length;p>h;h++)if(a[e[n][1]]==e[n][2][l][0][h]){i=!0;break}i&&(r+=this._useTemplate(e[n][2][l][1],a),f=!1)}f&&(r+=this._useTemplate(e[n][3],a));break;case t.USE:r+=this.useTemplate(e[n][1],a[e[n][2]])}return r}function c(e,t){return this._useTemplate(this.templates[e],t)}function u(e){null==e?this.templates={}:e in this.templates&&delete this.templates[e]}function i(e){localStorage.setItem(e,templates)}function h(e){this.templates=localStorage.getItem(e)}t.prototype.useTemplate=c,t.prototype.addTemplate=r,t.prototype.removeTemplate=u,t.prototype.saveTemplates=i,t.prototype.loadTemplates=h,t.prototype._parseTemplate=a,t.prototype._useTemplate=l,t.prototype._evaluateVariable=n,t.prototype._escapeHtml=s,"process"in e&&(module.exports=t),e.LWTE=t}((this||0).self||global);