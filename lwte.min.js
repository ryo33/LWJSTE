!function(e){"use strict;";function t(){this.templates={},arguments.callee.escape_character="#",arguments.callee.IF=0,arguments.callee.EACH=1,arguments.callee.SWITCH=2,arguments.callee.LITERAL=3,arguments.callee.VARIABLE=4,arguments.callee.USE=5,arguments.callee.HTML=6,arguments.callee.DIRECT=7}function a(e){function a(e){return[0,e]}function r(e,t){return[1,void 0==t?"":t,e[2],e[3],e[1]]}function n(e){return[1,e,[]]}function s(e,t){0!=t.length&&(O.push([e,t,B,D]),W="")}function c(e){switch(e.toLowerCase()){case"if":s(v,e);break;case"elif":s(_,e);break;case"else":s(d,e);break;case"/if":s(C,e);break;case"each":s(T,e);break;case"/each":s(S,e);break;case"switch":s(E,e);break;case"case":s(A,e);break;case"default":s(y,e);break;case"/switch":s(R,e);break;case"use":s(w,e);break;case"html":s(V,e);break;default:s(I,e)}}function l(e,t){e.splice(t,1)}function u(){return $+te+ae}function h(){var e=u();if(e<ce.length-1)l(ce,ce.length-1);else if(e>ce.length-1)for(var t=0,a=e-ce.length+1;a>t;t++)ce.push(se)}function i(e){if(h(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)i(e[t]);else-1==ce[u()].indexOf(e)&&ce[u()].push(e)}function p(e){if(h(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)p(e[t]);else for(var t=0,a=ce[u()].length;a>t;t++)if(e==ce[u()][t]){l(ce[u()],t);break}}function o(){return h(),-1!=ce[u()].indexOf(O[J][0])?!0:!1}function f(e){l(Q,Q.length-1),Q[Q.length-1]=X[X.length-1],l(X,X.length-1),void 0!=e&&e>1&&f(e-1)}function g(e){void 0==e&&(e=P.length-1),X.push(Q[Q.length-1]),Q.push(e)}function b(){P=N;for(var e=0,t=Q.length;t>e;e++)P=P[Q[e]]}function k(){for(var e=[],t=1,a=Z.length;a>t;t++)e.push(Z[t][1]);return e}for(var m=0,T=1,v=2,_=3,d=4,I=5,E=6,A=7,y=8,L=9,H=10,S=12,C=13,R=14,w=15,V=16,x=17,O=[],W="",B=1,D=0,F=!0,M=!1,U=!1,j=!1,q=null,z=0,G=e.length;G>z;z++)"\n"==e[z]&&(B++,D=0),D++,F?M?(M=!1,W+=e[z]==t.escape_character||"{"==e[z]||"}"==e[z]?e[z]:t.escape_character+e[z]):e[z]==t.escape_character?M=!0:"{"==e[z]?(s(m,W),s(L,"{"),F=!1):W+=e[z]:M?(M=!1,W+=e[z]==t.escape_character?e[z]:t.escape_character+e[z]):j?e[z]==t.escape_character?M=!0:e[z]==q?j=!1:W+=e[z]:e[z]==t.escape_character?M=!0:"}"==e[z]?(0!=W.length&&c(W),s(H,"}"),U=!1,F=!0):'"'==e[z]||"'"==e[z]?(j=!0,q=e[z]):" "==e[z]?0!=W.length&&c(W):W+=e[z];if(!F)return n("unclosed curly brackets");0!=W.length&&s(m,W);for(var J=0,K=O.length,N=[],P=N,Q=[],X=[],Y=!1,Z=[],$=0,ee=[],te=0,ae=0,re=[],ne=[],se=[_,d,A,y,S,C,R],ce=[se],le=!1;K>J;){if(o())return r(O[J],"unexpected token");if(b(),Y){if(O[J][0]==H){switch(Y=!1,0==Z.length&&Z.push([x]),Z[0][0]){case v:if(1==Z.length)return r(O[J]);$++,ee.push(!1),P.push([t.IF,[[k(),[]]],[]]),g(),g(1),g(0),g(1),p([_,d,C]);break;case _:if(0==$||1==Z.length||ee[$])return r(O[J]);f(2),b(),P.push([k(),[]]),g(),g(1);break;case d:if(0==$||ee[$]||1!=Z.length)return r(O[J]);ee[$]=!0,f(3),g(2),i(_);break;case C:if(0==$||1!=Z.length)return r(O[J]);ee[$]?(l(ee,$),f(2)):f(4),$--;break;case T:if(2!=Z.length)return r(O[J]);te++,P.push([t.EACH,Z[1][1],[]]),g(),g(2),p(S);break;case S:if(0==te||1!=Z.length)return r(O[J]);f(2),te--;break;case E:if(2!=Z.length)return r(O[J]);ae++,re.push(!1),ne.push(!1),P.push([t.SWITCH,Z[1][1],[],[]]),g(),g(2),p([A,y,R]),i([T,v,E]),le=!0;break;case A:if(0==ae||ne[ae]||1==Z.length)return r(O[J]);re[ae]&&(f(2),b()),P.push([k(),[]]),g(),g(1),re[ae]=!0,p([T,v,E]),le=!1;break;case y:if(0==ae||ne[ae]||1!=Z.length)return r(O[J]);ne[ae]=!0,re[ae]?f(3):f(),g(3),i(A),p([T,v,E]),le=!1;break;case R:if(0==ae||0==re[ae]||1!=Z.length)return r(O[J]);ne[ae]?f(2):re[ae]&&f(4),ae--,le=!1;break;case I:if(1!=Z.length)return r(O[J]);P.push([t.VARIABLE,Z[0][1]]);break;case x:P.push([t.DIRECT]);break;case w:if(3!=Z.length)return r(O[J]);P.push([t.USE,Z[1][1],Z[2][1]]);break;case V:if(2!=Z.length)return r(O[J]);P.push([t.HTML,Z[1][1]]);break;default:return r(O[J])}Z=[]}Z.push(O[J])}else switch(O[J][0]){case m:le||P.push([t.LITERAL,O[J][1]]);break;case L:Y=!0,Z=[]}J++}if(ae>0||$>0||te>0){var ue=$>0?" "+$+" if":"",he=te>0?" "+te+" each":"",ie=ae>0?" "+ae+" switch":"";return n("found not closed"+ue+he+ie)}return a(N)}function r(e,t){var a=this._parseTemplate(t);return 0==a[0]?(this.templates[e]=a[1],!1):a.slice(1)}function n(e){return e===!1||null==e||e instanceof Object&&0===Object.keys(e).length||e instanceof Array&&0==e.length?!1:!0}function s(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function c(e,a){for(var r="",n=0,s=e.length;s>n;n++)switch(e[n][0]){case t.LITERAL:r+=e[n][1];break;case t.VARIABLE:r+=this._escapeHtml(String(a[e[n][1]]));break;case t.HTML:r+=String(a[e[n][1]]);break;case t.DIRECT:r+=this._escapeHtml(String(a));break;case t.EACH:for(var c=0,l=a[e[n][1]].length;l>c;c++)r+=this._useTemplate(e[n][2],a[e[n][1]][c]);break;case t.IF:for(var u=!0,c=0,l=e[n][1].length;l>c;c++){for(var h=!0,i=0,p=e[n][1][c][0].length;p>i;i++)if(0==this._evaluateVariable(a[e[n][1][c][0][i]])){h=!1;break}if(h){r+=this._useTemplate(e[n][1][c][1],a),u=!1;break}}u&&(r+=this._useTemplate(e[n][2],a));break;case t.SWITCH:for(var o=!0,c=0,l=e[n][2].length;l>c;c++){for(var h=!1,i=0,p=e[n][2][c][0].length;p>i;i++)if(a[e[n][1]]==e[n][2][c][0][i]){h=!0;break}h&&(r+=this._useTemplate(e[n][2][c][1],a),o=!1)}o&&(r+=this._useTemplate(e[n][3],a));break;case t.USE:r+=this.useTemplate(e[n][1],a[e[n][2]])}return r}function l(e,t){return this._useTemplate(this.templates[e],t)}function u(e){null==e?this.templates={}:e in this.templates&&delete this.templates[e]}function h(e){localStorage.setItem(e,templates)}function i(e){this.templates=localStorage.getItem(e)}t.prototype.useTemplate=l,t.prototype.addTemplate=r,t.prototype.removeTemplate=u,t.prototype.saveTemplates=h,t.prototype.loadTemplates=i,t.prototype._parseTemplate=a,t.prototype._useTemplate=c,t.prototype._evaluateVariable=n,t.prototype._escapeHtml=s,"process"in e&&(module.exports=t),e.LWTE=t}((this||0).self||global);