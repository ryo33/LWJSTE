!function(e){"use strict;";function t(){this.templates={},arguments.callee.escape_character="#",arguments.callee.IF=0,arguments.callee.EACH=1,arguments.callee.SWITCH=2,arguments.callee.LITERAL=3,arguments.callee.VARIABLE=4,arguments.callee.USE=5,arguments.callee.HTML=6}function a(e){function a(e){return[0,e]}function r(e,t){return[1,void 0==t?"":t,e[2],e[3],e[1]]}function n(e){return[1,e,[]]}function s(e,t){0!=t.length&&(x.push([e,t,W,B]),O="")}function c(e){switch(e.toLowerCase()){case"if":s(v,e);break;case"elif":s(_,e);break;case"else":s(d,e);break;case"/if":s(w,e);break;case"each":s(T,e);break;case"/each":s(S,e);break;case"switch":s(y,e);break;case"case":s(I,e);break;case"default":s(L,e);break;case"/switch":s(C,e);break;case"use":s(R,e);break;case"html":s(V,e);break;default:s(A,e)}}function l(e,t){e.splice(t,1)}function u(){return Z+ee+te}function i(){var e=u();if(e<se.length-1)l(se,se.length-1);else if(e>se.length-1)for(var t=0,a=e-se.length+1;a>t;t++)se.push(ne)}function h(e){if(i(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)h(e[t]);else-1==se[u()].indexOf(e)&&se[u()].push(e)}function o(e){if(i(),e instanceof Array)for(var t=0,a=e.length;a>t;t++)o(e[t]);else for(var t=0,a=se[u()].length;a>t;t++)if(e==se[u()][t]){l(se[u()],t);break}}function p(){return i(),-1!=se[u()].indexOf(x[G][0])?!0:!1}function f(e){l(P,P.length-1),P[P.length-1]=Q[Q.length-1],l(Q,Q.length-1),void 0!=e&&e>1&&f(e-1)}function g(e){void 0==e&&(e=N.length-1),Q.push(P[P.length-1]),P.push(e)}function b(){N=K;for(var e=0,t=P.length;t>e;e++)N=N[P[e]]}function k(){for(var e=[],t=1,a=Y.length;a>t;t++)e.push(Y[t][1]);return e}for(var m=0,T=1,v=2,_=3,d=4,A=5,y=6,I=7,L=8,E=9,H=10,S=12,w=13,C=14,R=15,V=16,x=[],O="",W=1,B=0,F=!0,M=!1,U=!1,j=!1,q=null,z=0,D=e.length;D>z;z++)"\n"==e[z]&&(W++,B=0),B++,F?M?(M=!1,O+=e[z]==t.escape_character||"{"==e[z]||"}"==e[z]?e[z]:t.escape_character+e[z]):e[z]==t.escape_character?M=!0:"{"==e[z]?(s(m,O),s(E,"{"),F=!1):O+=e[z]:M?(M=!1,O+=e[z]==t.escape_character?e[z]:t.escape_character+e[z]):j?e[z]==t.escape_character?M=!0:e[z]==q?j=!1:O+=e[z]:e[z]==t.escape_character?M=!0:"}"==e[z]?(0!=O.length&&c(O),s(H,"}"),U=!1,F=!0):'"'==e[z]||"'"==e[z]?(j=!0,q=e[z]):" "==e[z]?0!=O.length&&c(O):O+=e[z];if(!F)return n("unclosed curly brackets");0!=O.length&&s(m,O);for(var G=0,J=x.length,K=[],N=K,P=[],Q=[],X=!1,Y=[],Z=0,$=[],ee=0,te=0,ae=[],re=[],ne=[_,d,I,L,S,w,C],se=[ne],ce=!1;J>G;){if(p())return r(x[G],"unexpected token");if(b(),X){if(x[G][0]==H){switch(X=!1,Y[0][0]){case v:if(1==Y.length)return r(x[G]);Z++,$.push(!1),N.push([t.IF,[[k(),[]]],[]]),g(),g(1),g(0),g(1),o([_,d,w]);break;case _:if(0==Z||1==Y.length||$[Z])return r(x[G]);f(2),b(),N.push([k(),[]]),g(),g(1);break;case d:if(0==Z||$[Z]||1!=Y.length)return r(x[G]);$[Z]=!0,f(3),g(2),h(_);break;case w:if(0==Z||1!=Y.length)return r(x[G]);$[Z]?(l($,Z),f(2)):f(4),Z--;break;case T:if(2!=Y.length)return r(x[G]);ee++,N.push([t.EACH,Y[1][1],[]]),g(),g(2),o(S);break;case S:if(0==ee||1!=Y.length)return r(x[G]);f(2),ee--;break;case y:if(2!=Y.length)return r(x[G]);te++,ae.push(!1),re.push(!1),N.push([t.SWITCH,Y[1][1],[],[]]),g(),g(2),o([I,L,C]),h([T,v,y]),ce=!0;break;case I:if(0==te||re[te]||1==Y.length)return r(x[G]);ae[te]&&(f(2),b()),N.push([k(),[]]),g(),g(1),ae[te]=!0,o([T,v,y]),ce=!1;break;case L:if(0==te||re[te]||1!=Y.length)return r(x[G]);re[te]=!0,ae[te]?f(3):f(),g(3),h(I),o([T,v,y]),ce=!1;break;case C:if(0==te||0==ae[te]||1!=Y.length)return r(x[G]);re[te]?f(2):ae[te]&&f(4),te--,ce=!1;break;case A:if(1!=Y.length)return r(x[G]);N.push([t.VARIABLE,Y[0][1]]);break;case R:if(3!=Y.length)return r(x[G]);N.push([t.USE,Y[1][1],Y[2][1]]);break;case V:if(2!=Y.length)return r(x[G]);N.push([t.HTML,Y[1][1]]);break;default:return r(x[G])}Y=[]}Y.push(x[G])}else switch(x[G][0]){case m:ce||N.push([t.LITERAL,x[G][1]]);break;case E:X=!0,Y=[]}G++}if(te>0||Z>0||ee>0){var le=Z>0?" "+Z+" if":"",ue=ee>0?" "+ee+" each":"",ie=te>0?" "+te+" switch":"";return n("found not closed"+le+ue+ie)}return a(K)}function r(e,t){var a=this._parseTemplate(t);return 0==a[0]?(this.templates[e]=a[1],!1):a.slice(1)}function n(e){return e===!1||null==e||e instanceof Object&&0===Object.keys(e).length||e instanceof Array&&0==e.length?!1:!0}function s(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function c(e,a){for(var r="",n=0,s=e.length;s>n;n++)switch(e[n][0]){case t.LITERAL:r+=e[n][1];break;case t.VARIABLE:r+=this._escapeHtml(String(a[e[n][1]]));break;case t.HTML:r+=String(a[e[n][1]]);break;case t.EACH:for(var c=0,l=a[e[n][1]].length;l>c;c++)r+=this._useTemplate(e[n][2],a[e[n][1]][c]);break;case t.IF:for(var u=!0,c=0,l=e[n][1].length;l>c;c++){for(var i=!0,h=0,o=e[n][1][c][0].length;o>h;h++)if(0==this._evaluateVariable(a[e[n][1][c][0][h]])){i=!1;break}if(i){r+=this._useTemplate(e[n][1][c][1],a),u=!1;break}}u&&(r+=this._useTemplate(e[n][2],a));break;case t.SWITCH:for(var p=!0,c=0,l=e[n][2].length;l>c;c++){for(var i=!1,h=0,o=e[n][2][c][0].length;o>h;h++)if(a[e[n][1]]==e[n][2][c][0][h]){i=!0;break}i&&(r+=this._useTemplate(e[n][2][c][1],a),p=!1)}p&&(r+=this._useTemplate(e[n][3],a));break;case t.USE:r+=this.useTemplate(e[n][1],a[e[n][2]])}return r}function l(e,t){return this._useTemplate(this.templates[e],t)}function u(e){null==e?this.templates={}:e in this.templates&&delete this.templates[e]}function i(e){localStorage.setItem(e,templates)}function h(e){this.templates=localStorage.getItem(e)}t.prototype.useTemplate=l,t.prototype.addTemplate=r,t.prototype.removeTemplate=u,t.prototype.saveTemplates=i,t.prototype.loadTemplates=h,t.prototype._parseTemplate=a,t.prototype._useTemplate=c,t.prototype._evaluateVariable=n,t.prototype._escapeHtml=s,"process"in e&&(module.exports=t),e.LWTE=t}((this||0).self||global);